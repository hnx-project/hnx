# C 标准库 (C Standard Library)

`libc` 模块 (`space/libc`) 是 HNX 操作系统用户空间的 C 语言标准库实现。在 HNX 这样的微内核环境中，传统的 C 标准库需要适配新的系统接口和底层通信机制。`libc` 的目标是为使用 C/C++ 语言编写的用户空间程序提供一个兼容 POSIX 风格的编程环境，使这些程序能够方便地在 HNX 上运行，并与内核及其他服务进行交互。

## 设计目标

-   **兼容性:** 尽可能兼容 POSIX 标准，方便移植现有的 C/C++ 代码。
-   **微内核适配:** 将标准的 C 库函数调用转换为 HNX 的系统调用或 IPC 消息，以便与用户空间服务（如 VFS 服务、进程管理服务）通信。
-   **`no_std` 兼容:** `libc` 的实现需要能够与 HNX 的 `no_std` 环境集成。
-   **精简高效:** 在满足兼容性的前提下，保持库的精简和高效，减少不必要的开销。

## 核心组成部分

### `lib.rs` (主模块)

`libc` 的主模块，负责导出所有 C 语言接口，并将它们映射到 Rust 实现的函数或 HNX 系统调用。这包括内存管理函数 (`malloc`, `free`)、字符串处理函数 (`strcpy`, `strlen`)、以及其他通用实用程序。

-   **系统调用封装:** 许多 C 库函数（如文件 I/O）会间接调用 `hnxlib` 提供的系统调用封装或直接通过 IPC 与服务通信。
-   **错误码映射:** 将 HNX 内部的错误类型映射为标准的 C 错误码 (`errno`)，方便 C 程序处理。

### `print.rs` (打印功能)

`print.rs` 模块负责实现 C 标准库中的打印功能，例如 `printf`。在操作系统环境中，直接向控制台打印需要与底层的 UART 驱动或控制台服务进行交互。

-   **输出重定向:** `printf` 的输出通常会被重定向到内核的控制台输出 (`HNX_SYS_WRITE`) 或一个用户空间的服务（例如一个日志服务）。
-   **格式化:** 实现字符串格式化功能，支持各种数据类型的打印。

## `libc` 与 `hnxlib` 的关系

`libc` 和 `hnxlib` 在 HNX 的用户空间中扮演着不同的角色，但又紧密协作：

-   **`hnxlib`:** 是 HNX 原生的 Rust 系统库，提供 HNX 特有的高级 API 和服务框架。它更偏向于 HNX 的“原生”编程接口。
-   **`libc`:** 旨在提供传统的 C 语言接口，是 `hnxlib` 之上的一个兼容层，将 C 语言世界的函数调用桥接到 HNX 的底层机制。

对于纯 Rust 编写的 HNX 用户空间组件，可以直接使用 `hnxlib`。而对于需要兼容 C 语言生态系统（如现有的 C 应用程序、第三方 C 库）的组件，`libc` 则提供了必要的支持。

## 未来展望

`libc` 的实现将随着 HNX 功能的完善而逐步扩展，以覆盖更多的 C 标准库功能，并不断优化其性能和兼容性。目标是创建一个功能完整、稳定可靠的 C 语言运行环境。