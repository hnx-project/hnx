# 驱动程序 (Kernel Drivers)

HNX 内核的 `drivers` 模块 (`kernel/src/drivers`) 负责管理系统中的硬件设备。驱动程序是操作系统与底层硬件交互的桥梁，它们将复杂的硬件操作抽象为统一的软件接口，供内核的其他部分和用户空间服务使用。这种模块化的设计使得 HNX 能够支持多样化的硬件，并增强了系统的可扩展性。

## 结构与设计

`drivers` 模块通常包含特定硬件设备的代码，这些设备可能包括：

-   **块设备 (`block/`):** 管理存储设备，如硬盘或固态硬盘的读写操作。
-   **总线 (`bus/`):** 实现不同类型总线（如 PCIe, I2C, SPI 等）的驱动框架和通用操作，允许连接更多设备。
-   **设备管理器 (`device_manager/`):** 负责发现、枚举和管理系统中的硬件设备，为设备提供注册和查询机制。
-   **设备树二进制 (`dtb/`):** 包含设备树 (Device Tree) 解析器，用于在 ARM 架构系统中描述硬件布局和配置。
-   **通用中断控制器 (`gic/`):** 实现 ARM 通用中断控制器 (Generic Interrupt Controller) 的驱动，负责管理中断的路由、优先级和处理。
-   **网络 (`net/`):** 提供网络接口设备的驱动，处理数据的发送和接收，实现网络协议栈的基础。
-   **UART (`uart/`):** 通用异步收发传输器 (Universal Asynchronous Receiver-Transmitter) 驱动，用于串口通信，通常作为调试输出和基本输入设备。

## 关键功能

-   **硬件初始化:** 在系统启动时，驱动程序负责初始化其对应的硬件设备。
-   **设备抽象:** 提供统一的 API，隐藏硬件的复杂性，使上层软件可以方便地与设备交互。
-   **中断处理:** 注册和处理来自硬件设备的中断，及时响应硬件事件。
-   **数据传输:** 管理设备与内存之间的数据传输，例如通过 DMA (直接内存访问) 提高效率。
-   **电源管理:** 在必要时对设备进行电源管理，以节省能源。

## 设计目标

-   **模块化:** 驱动程序应是独立的模块，易于开发、测试和替换。
-   **可移植性:** 尽可能地将通用驱动逻辑与硬件特定细节分离，以便在不同硬件平台之间复用代码。
-   **性能:** 驱动程序需要高效地利用硬件资源，减少开销，以满足实时和高性能需求。
-   **安全性:** 驱动程序对硬件拥有特权访问，因此必须确保其安全性，防止恶意操作。

通过精心设计的驱动程序架构，HNX 旨在提供一个灵活、健壮的硬件支持层，为构建功能丰富的操作系统奠定基础。